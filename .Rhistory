## CLEANING
spectra2 =
spectra %>%
# select only necessary columns
# the peaks are split into two columns. merge them
dplyr::select(source,
ppm, ppm.1,
Intensity, Intensity.1,
Area, Area.1) %>%
gather(ppm, value, ppm:ppm.1)
## CLEANING
spectra2 =
spectra %>%
# select only necessary columns
# the peaks are split into two columns. merge them
dplyr::select(source,
ppm, ppm.1,
Intensity, Intensity.1,
Area, Area.1) %>%
gather(ppm, value, ppm:ppm.1) %>%
gather(Area, avalue, Area:Area.1)
spectra_temp1 =
spectra %>%
dplyr::select(source, ppm, Intensity, Area)
spectra_temp2 =
spectra %>%
dplyr::select(source, ppm.1, Intensity.1, Area.1)
View(spectra_temp1)
View(spectra_temp2)
spectra_temp2 =
spectra %>%
dplyr::select(source, ppm.1, Intensity.1, Area.1) %>%
rename(ppm = ppm.1)
spectra_temp2 =
spectra %>%
dplyr::select(source, ppm.1, Intensity.1, Area.1) %>%
rename(ppm = ppm.1,
Intensity = Intensity.1,
Area = Area.1)
## CLEANING
spectra2 =
spectra_temp1 %>%
left_join(spectra_temp2, by = "source")
## CLEANING
spectra2 =
spectra_temp1 %>%
cbind(spectra_temp2, by = "source")
## CLEANING
spectra2 =
spectra_temp1 %>%
rbind(spectra_temp2, by = "source")
## CLEANING
spectra2 =
spectra_temp1 %>%
rbind(spectra_temp2)
## CLEANING
spectra2 =
spectra_temp1 %>%
rbind(spectra_temp2)
spectra3 =
subset(merge(spectra2, bins2), start <= ppm & ppm <= stop) %>%
dplyr::select(source,ppm, Intensity, group) %>%
filter(!(ppm>DMSO_start&ppm<DMSO_stop)) %>%
group_by(source, group) %>%
dplyr::summarize(intensity = sum(Intensity)) %>%
group_by(source) %>%
dplyr::mutate(total = sum(intensity),
relabund = round((intensity/total)*100,2))%>%
mutate(pos = cumsum(relabund)- relabund/2)
View(spectra3)
ggplot(data=spectra3, aes(x="", y=relabund, fill=group)) +
geom_bar(stat="identity", alpha=0.7) +
#geom_text(aes(x= "", y=pos, label = relabund), size=4) +  # note y = pos
facet_wrap(facets = .~source, labeller = label_value) +
coord_polar(theta = "y")+theme_bw()
gg_nmr+
geom_point(data=SPECTRA_134, aes(x = ppm, y = intensity))+
ylim(-1000,6000)+
# if you need to add labels:
annotate("text", label = "aliphatic", x = 1.4, y = -700)+
annotate("text", label = "O-alkyl", x = 3.5, y = -700)+
annotate("text", label = "alpha-H", x = 4.45, y = -700)+
annotate("text", label = "aromatic", x = 7, y = -700)+
annotate("text", label = "amide", x = 8.1, y = -700)+
annotate("text", label = "\n\nWATER", x = 3.5, y = Inf)+
annotate("text", label = "\n\nDMSO", x = 2.48, y = Inf)+
geom_vline(xintercept = WATER_start, linetype="longdash")+
geom_vline(xintercept = WATER_stop, linetype="longdash")+
geom_vline(xintercept = DMSO_start, linetype="dashed")+
geom_vline(xintercept = DMSO_stop, linetype="dashed")
library(readxl)
library(readr)
library(tidyverse)
library(dplyr)
library(ggplot2)
BINSET = "Clemente2012"
bins = read_csv("nmr_bins.csv")
bins2 =
bins %>%
# here we select only the BINSET we chose above
dplyr::select(group,startstop,BINSET) %>%
na.omit %>%
spread(startstop,BINSET)
#
## 2. bins for water and DMSO solvent ----
WATER_start = 3
WATER_stop = 4
DMSO_start = 2.25
DMSO_stop = 2.75
## 3. spectra plot parameters ----
gg_nmr =
ggplot()+
geom_rect(data=bins2, aes(xmin=start, xmax=stop, ymin=-Inf, ymax=+Inf, fill=group), color="grey70",alpha=0.1)+
scale_x_reverse(limits = c(10,0))+
xlab("shift, ppm")+
ylab("intensity")+
theme_bw() %+replace%
theme(legend.position = "right",
legend.key=element_blank(),
legend.title = element_blank(),
legend.text = element_text(size = 12),
legend.key.size = unit(1.5, 'lines'),
panel.border = element_rect(color="black",size=1.5, fill = NA),
plot.title = element_text(hjust = 0.05, size = 14),
axis.text = element_text(size = 14, color = "black"),
axis.title = element_text(size = 14, face = "bold", color = "black"),
# formatting for facets
panel.background = element_blank(),
strip.background = element_rect(colour="white", fill="white"), #facet formatting
panel.spacing.x = unit(1.5, "lines"), #facet spacing for x axis
panel.spacing.y = unit(1.5, "lines"), #facet spacing for x axis
strip.text.x = element_text(size=12, face="bold"), #facet labels
strip.text.y = element_text(size=12, face="bold", angle = 270) #facet labels
)
filePaths <- list.files(path = "data/peaks/",pattern = "*.csv", full.names = TRUE)
spectra <- do.call(rbind, lapply(filePaths, function(path) {
# the files are tab-delimited, so read.csv will not work. import using read.table
# there is no header. so create new column names
# then add a new column `source` to denote the file name
df <- read.csv(path, header=TRUE)
df[["source"]] <- rep(path, nrow(df))
df}))
spectra_temp1 =
spectra %>%
dplyr::select(source, ppm, Intensity, Area)
spectra_temp = spectra
View(spectra_temp)
spectra2 =
spectra_temp %>%
gather(key = "variable",
value = "value",
-source)
View(spectra2)
spectra2 =
spectra_temp %>%
gather(key = "variable",
value = "value",
-source) %>%
dplyr::mutate(VAR = case_when(
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"variable"))
View(spectra_temp1)
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width")) %>%
filter(!is.na(VAR))
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width")) %>%
!is.na(VAR)
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width")) %>%
dplyr::filter(!is.na(VAR))
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width")) %>%
dplyr::filter(!is.na(value))
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width")) %>%
dplyr::filter(value=="NA")
spectra2 =
spectra_temp %>%
gather(key = "variable",
value = "value",
-source) %>%
dplyr::mutate(VAR = case_when(
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width"))
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width")) %>%
na.omit(VAR)
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width")) %>%
na.omit()
library(dplyr)
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width")) %>%
na.omit()
??na.omit
??filter
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width")) %>%
dplyr::filter(variable=="ppm")
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width")) %>%
filter(variable=="ppm")
library(readxl)
library(readr)
library(tidyverse)
library(dplyr)
library(ggplot2)
filePaths <- list.files(path = "data/peaks/",pattern = "*.csv", full.names = TRUE)
spectra <- do.call(rbind, lapply(filePaths, function(path) {
# the files are tab-delimited, so read.csv will not work. import using read.table
# there is no header. so create new column names
# then add a new column `source` to denote the file name
df <- read.csv(path, header=TRUE)
df[["source"]] <- rep(path, nrow(df))
df}))
spectra_temp1 =
spectra %>%
dplyr::select(source, ppm, Intensity, Area)
spectra_temp = spectra
spectra_temp =
spectra %>%
gather(key = "variable",
value = "value",
-source) %>%
dplyr::mutate(VAR = case_when(
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width")) %>%
filter(variable=="ppm")
View(spectra_temp)
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width")) %>%
filter(!is.na(VAR))
pectra_temp =
spectra %>%
gather(key = "variable",
value = "value",
-source) %>%
dplyr::mutate(VAR = case_when(
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width"))
spectra_temp =
spectra %>%
gather(key = "variable",
value = "value",
-source) %>%
dplyr::mutate(VAR = case_when(
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width"))
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width")) %>%
filter(!is.na(VAR))
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width")) %>%
dplyr::filter(!is.na(VAR))
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width")) %>%
dplyr::filter(!is.na(VAR))
spectra_temp =
spectra %>%
gather(key = "variable", value = "value",
-source) %>%
dplyr::mutate(VAR = case_when(
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width"))
spectra_temp %>%
dplyr::filter(!is.na(VAR))
spectra_temp =
spectra_temp %>%
dplyr::filter(!is.na(VAR))
spectra_temp %>%
dplyr::filter(!is.na(VAR)) %>%
dplyr::select(-variable)
spectra_temp %>%
dplyr::filter(!is.na(VAR)) %>%
dplyr::select(-variable)
spectra_temp =
spectra_temp %>%
dplyr::filter(!is.na(VAR)) %>%
dplyr::select(-variable)
spectra_temp =
spectra_temp %>%
dplyr::filter(!is.na(VAR)) %>%
dplyr::select(-variable)
spectra_temp =
spectra %>%
gather(key = "variable", value = "value",
-source) %>%
dplyr::mutate(VAR = case_when(
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width"))
spectra_temp =
spectra_temp %>%
dplyr::filter(!is.na(VAR)) %>%
dplyr::select(-variable)
spectra_temp =
spectra %>%
gather(key = "variable", value = "value",
-source) %>%
dplyr::mutate(VAR = case_when(
grepl("ppm",variable)~"ppm",
grepl("Intensity",variable)~"Intensity",
grepl("Width",variable)~"Width"))
spectra_temp_b =
spectra_temp %>%
dplyr::filter(!is.na(VAR)) %>%
dplyr::select(-variable)
View(spectra_temp_b)
spectra_temp_b =
spectra_temp %>%
dplyr::filter(!is.na(VAR)) %>%
dplyr::select(-variable) %>%
spread(2:3)
spectra_temp_b =
spectra_temp %>%
dplyr::filter(!is.na(VAR)) %>%
dplyr::select(-variable) %>%
spread(Var,value)
spectra_temp_b =
spectra_temp %>%
dplyr::filter(!is.na(VAR)) %>%
dplyr::select(-variable) %>%
spread(VAR,value)
spectra_temp_b =
spectra_temp %>%
dplyr::filter(!is.na(VAR)) %>%
dplyr::select(-variable) %>%
spread()
spectra_temp_b =
spectra_temp %>%
dplyr::filter(!is.na(VAR)) %>%
dplyr::select(-variable) %>%
spread(value,var)
spectra_temp_b =
spectra_temp %>%
dplyr::filter(!is.na(VAR)) %>%
dplyr::select(-variable) %>%
spread(value,VAR)
View(spectra_temp_b)
View(spectra)
library(readxl)
library(readr)
library(tidyverse)
library(dplyr)
library(ggplot2)
filePaths <- list.files(path = "data/peaks/",pattern = "*.csv", full.names = TRUE)
spectra <- do.call(rbind, lapply(filePaths, function(path) {
# the files are tab-delimited, so read.csv will not work. import using read.table
# there is no header. so create new column names
# then add a new column `source` to denote the file name
df <- read.csv(path, header=TRUE)
df[["source"]] <- rep(path, nrow(df))
df}))
View(spectra)
## TRYING to collapse the columns
spectra_Area =
spectra %>%
dplyr::select(starts_with("Area"))
View(spectra_Area)
## TRYING to collapse the columns
spectra_Area =
spectra %>%
dplyr::select(starts_with("Area")) %>%
gather()
spectra_ppm =
spectra %>%
dplyr::select(starts_with("ppm")) %>%
gather()
View(spectra_ppm)
spectra_Intensity =
spectra %>%
dplyr::select(starts_with("Intensity")) %>%
gather()
View(spectra)
spectra_Width =
spectra %>%
dplyr::select(starts_with("Width")) %>%
gather()
spectra_Source =
spectra %>%
dplyr::select(starts_with("Spurce")) %>%
gather()
spectra_Source =
spectra %>%
dplyr::select(starts_with("Source")) %>%
gather()
merged =
cbind(spectra_Source, spectra_ppm)
View(merged)
spectra_ppm =
spectra %>%
dplyr::select(starts_with("ppm")) %>%
gather() %>%
dplyr::select(value) %>%
rename(ppm=value)
spectra_ppm =
spectra %>%
dplyr::select(starts_with("ppm")) %>%
gather() %>%
dplyr::select(value) %>%
rename(ppm=value)
spectra_Intensity =
spectra %>%
dplyr::select(starts_with("Intensity")) %>%
gather() %>%
dplyr::select(value) %>%
rename(Intensity=value)
spectra_Width =
spectra %>%
dplyr::select(starts_with("Width")) %>%
gather() %>%
dplyr::select(value) %>%
rename(Width=value)
spectra_Source =
spectra %>%
dplyr::select(starts_with("Source")) %>%
gather() %>%
dplyr::select(value) %>%
rename(Source=value)
merged =
cbind(spectra_Source, spectra_ppm)
merged =
cbind(spectra_Source, spectra_ppm, spectra_Intensity, spectra_Width,spectra_Area)
## TRYING to collapse the columns
spectra_Area =
spectra %>%
dplyr::select(starts_with("Area")) %>%
gather() %>%
dplyr::select(value) %>%
rename(Area=value)
merged =
cbind(spectra_Source, spectra_ppm, spectra_Intensity, spectra_Width,spectra_Area)
### OUTPUT
write_csv(merged,"merged.csv")
filePaths <- list.files(path = "data/peaks/",pattern = "*.csv", full.names = TRUE)
spectra <- do.call(rbind, lapply(filePaths, function(path) {
# the files are tab-delimited, so read.csv will not work. import using read.table
# there is no header. so create new column names
# then add a new column `source` to denote the file name
df <- read.csv(path, header=TRUE)
df[["source"]] <- rep(path, nrow(df))
df}))
spectra_temp1 =
spectra %>%
dplyr::select(source, ppm, Intensity, Area)
spectra_temp2 =
spectra %>%
dplyr::select(source, ppm.1, Intensity.1, Area.1) %>%
rename(ppm = ppm.1,
Intensity = Intensity.1,
Area = Area.1)
## CLEANING
spectra2 =
spectra_temp1 %>%
rbind(spectra_temp2)
## TRYING to collapse the columns
spectra_Area =
spectra %>%
dplyr::select(starts_with("Area")) %>%
gather() %>%
dplyr::select(value) %>%
rename(Area=value)
spectra_ppm =
spectra %>%
dplyr::select(starts_with("ppm")) %>%
gather() %>%
dplyr::select(value) %>%
rename(ppm=value)
spectra_Intensity =
spectra %>%
dplyr::select(starts_with("Intensity")) %>%
gather() %>%
dplyr::select(value) %>%
rename(Intensity=value)
spectra_Width =
spectra %>%
dplyr::select(starts_with("Width")) %>%
gather() %>%
dplyr::select(value) %>%
rename(Width=value)
spectra_Source =
spectra %>%
dplyr::select(starts_with("Source")) %>%
gather() %>%
dplyr::select(value) %>%
rename(Source=value)
merged =
cbind(spectra_Source, spectra_ppm, spectra_Intensity, spectra_Width,spectra_Area)
### OUTPUT
write_csv(merged,"merged.csv")
write_csv(spectra2,"processed_peaks.csv")
??spread
